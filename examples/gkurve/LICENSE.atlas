This implementation comes from https://gist.github.com/mitchellh/0c023dbd381c42e145b5da8d58b1487f
